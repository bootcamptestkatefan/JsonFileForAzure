{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "alertName": {
      "type": "string",
      "metadata": {
        "description": "MetricTesting"
      }
    },
    "alertDescription": {
      "type": "string",
      "defaultValue": "[katefan] created new template for testing ",
      "metadata": {
        "description": "Check if CPU higher then 6 percent"
      }
    },
    "isEnabled": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Specifies whether alerts are enabled"
      }
    },
    "resourceId": {
      "type": "string",
      "defaultValue": "1572d25b-4161-4e7b-937e-76154835cb13",
      "metadata": {
        "description": "Resource ID of the resource emitting the metric that will be used for the comparison."
      }
    },
    "metricName": {
      "type": "string",
      "defaultValue": "cpu_percent",
      "metadata": {
        "description": "Percentage CPU(Platform)"
      } 
    },
    "operator": {
      "type": "string",
      "defaultValue": "GreaterThan",
      "allowedValues": [
        "GreaterThan"
      ],
      "metadata": {
        "description": "Operator comparing the current value with the threshold value."
      }
    },
    "threshold": {
      "type": "string",
      "defaultValue": "6",
      "metadata": {
        "description": "The threshold value at which the alert is activated."
      }
    },
    "aggregation": {
      "type": "string",
      "defaultValue": "Average",
      "allowedValues": [
        "Average"
      ],
      "metadata": {
        "description": "How the data that is collected should be combined over time."
      }
    },
    "windowSize": {
      "type": "string",
      "defaultValue": "PT5M",
      "metadata": {
        "description": "Check every 5 mins. Use ISO 8601 duration format."
      }
    },
    "sendToServiceOwners": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Specifies whether alerts are sent to service owners"
      }
    },
    "customEmailAddresses": {
      "type": "string",
      "defaultValue": "kate.fan@oocl.com",
      "metadata": {
        "description": "kate.fan@oocl.com"
      }
    },
    "Subscription": {
      "type": "string",
      "defaultValue": "solace_PCF",
      "metadata": {
        "description": "solace_PCF"
      }
    }
  },
  "variables": {
    "customEmails": "[parameters('customEmailAddresses')]"
  },

  "resources": [
    {
      "type": "Microsoft.Insights/alertRules",
      "name": "[parameters('alertName')]",
      "apiVersion": "2017-04-01",
      "location": "Global",
      "dependsOn": [
        "Testing_for_email_alert_20181115"
      ],
      "properties": {
        "name": "[parameters('alertName')]",
        "scopes": [
          "/subscriptions/1572d25b-4161-4e7b-937e-76154835cb13/resourcegroups/Solace_POC/providers/microsoft.compute/virtualmachines/SolaceDocker02"
        ],
        "description": "[parameters('alertDescription')]",
        "isEnabled": "[parameters('isEnabled')]",
        "condition": {
          "odata.type": "Microsoft.Azure.Management.Insights.Models.ThresholdRuleCondition",
          "dataSource": {
            "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleMetricDataSource",
            "resourceUri": "[parameters('resourceId')]",
            "metricName": "[parameters('metricName')]"
          },
          "operator": "[parameters('operator')]",
          "threshold": "[parameters('threshold')]",
          "windowSize": "[parameters('windowSize')]",
          "timeAggregation": "[parameters('aggregation')]"
        }
      },
      "actions": [
        {
          "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleEmailAction",
          "sendToServiceOwners": "[parameters('sendToServiceOwners')]",
          "customEmails": "[variables('customEmails')]"
        }
      ]
    }
  ]
}