{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "alertName": {
            "type": "String",
            "metadata": {
                "description": "MetricTesting"
            }
        },
        "alertDescription": {
            "defaultValue": "[katefan] created new template for testing ",
            "type": "String",
            "metadata": {
                "description": "Check if CPU higher then 6 percent"
            }
        },
        "isEnabled": {
            "defaultValue": true,
            "type": "Bool",
            "metadata": {
                "description": "Specifies whether alerts are enabled"
            }
        },
        "resourceId": {
            "defaultValue": "/subscriptions/1572d25b-4161-4e7b-937e-76154835cb13",
            "type": "String",
            "metadata": {
                "description": "Resource ID of the resource emitting the metric that will be used for the comparison."
            }
        },
        "metricName": {
            "defaultValue": "cpu_percent",
            "type": "String",
            "metadata": {
                "description": "Percentage CPU(Platform)"
            }
        },
        "operator": {
            "defaultValue": "GreaterThan",
            "allowedValues": [
                "GreaterThan"
            ],
            "type": "String",
            "metadata": {
                "description": "Operator comparing the current value with the threshold value."
            }
        },
        "threshold": {
            "defaultValue": "6",
            "type": "String",
            "metadata": {
                "description": "The threshold value at which the alert is activated."
            }
        },
        "aggregation": {
            "defaultValue": "Average",
            "allowedValues": [
                "Average"
            ],
            "type": "String",
            "metadata": {
                "description": "How the data that is collected should be combined over time."
            }
        },
        "windowSize": {
            "defaultValue": "PT5M",
            "type": "String",
            "metadata": {
                "description": "Check every 5 mins. Use ISO 8601 duration format."
            }
        },
        "sendToServiceOwners": {
            "defaultValue": true,
            "type": "Bool",
            "metadata": {
                "description": "Specifies whether alerts are sent to service owners"
            }
        },
        "customEmailAddresses": {
            "defaultValue": "kate.fan@oocl.com",
            "type": "String",
            "metadata": {
                "description": "kate.fan@oocl.com"
            }
        },
        "Subscription": {
            "defaultValue": "solace_PCF",
            "type": "String",
            "metadata": {
                "description": "solace_PCF"
            }
        }
    },
    "variables": {
        "customEmails": "[parameters('customEmailAddresses')]"
    },
    "resources": [
        {
            "type": "Microsoft.Insights/alertRules",
            "name": "[parameters('alertName')]",
            "apiVersion": "2016-03-01",
            "location": "eastasia",
            "properties": {
                "name": "[parameters('alertName')]",
                "scopes": [
                    "/subscriptions/1572d25b-4161-4e7b-937e-76154835cb13/resourcegroups/Solace_POC/providers/microsoft.compute/virtualmachines/SolaceDocker03"
                ],
                "description": "[parameters('alertDescription')]",
                "isEnabled": "[parameters('isEnabled')]",
                "condition": {
                    "odata.type": "Microsoft.Azure.Management.Insights.Models.ThresholdRuleCondition",
                    "dataSource": {
                        "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleMetricDataSource",
                        "resourceUri": "[parameters('resourceId')]",
                        "metricName": "[parameters('metricName')]"
                    },
                    "operator": "[parameters('operator')]",
                    "threshold": "[parameters('threshold')]",
                    "windowSize": "[parameters('windowSize')]",
                    "timeAggregation": "[parameters('aggregation')]"
                },
                "actions": {
                    "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleEmailAction",
                    "sendToServiceOwners": "[parameters('sendToServiceOwners')]",
                    "customEmails": [
                        "[variables('customEmails')]"
                    ]
                }
            }
        }
    ]
}